<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>人生の輪 (Wheel of Life)</title>
    <style>
        /* 基本スタイル */
        body {
            font-family: "Helvetica Neue", Arial, sans-serif;
            background-color: #f4f7f6;
            color: #333;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            padding: 20px;
        }

        h1 {
            margin-bottom: 20px;
            color: #2c3e50;
        }

        /* メインレイアウト */
        .container {
            display: flex;
            flex-wrap: wrap;
            gap: 40px;
            background: #ffffff;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            max-width: 1000px;
            width: 90%;
            justify-content: center;
        }

        /* 左側：入力エリア */
        .input-area {
            flex: 1;
            min-width: 300px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .input-group {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding-bottom: 5px;
            border-bottom: 1px solid #eee;
        }

        .input-label {
            font-weight: bold;
            font-size: 14px;
            width: 120px;
        }

        .slider-wrapper {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        input[type="range"] {
            flex: 1;
            cursor: pointer;
        }

        .score-value {
            font-weight: bold;
            color: #4A90E2;
            width: 25px;
            text-align: right;
        }

        /* 右側：グラフエリア */
        .chart-area {
            width: 500px;
            height: 500px;
            position: relative;
        }

        svg {
            width: 100%;
            height: 100%;
            overflow: visible;
            cursor: pointer;
            user-select: none;
        }

        .slice {
            fill-opacity: 0.6;
            transition: d 0.3s ease;
            stroke: none; /* 枠線なし */
        }
        .slice:hover {
            fill-opacity: 0.8;
        }

        /* ガイド（円・線） */
        .guide-circle {
            fill: none;
            stroke: #e0e0e0;
            stroke-dasharray: 4,4;
            stroke-width: 1;
            pointer-events: none;
        }
        /* 5のラインだけ少し目立たせる（オプション） */
        .guide-circle.highlight {
            stroke: #bbb;
            stroke-dasharray: none;
        }

        .guide-line {
            stroke: #e0e0e0;
            stroke-width: 1;
            pointer-events: none;
        }
        
        /* 目盛りテキスト（5のみ） */
        .scale-text {
            font-size: 14px;
            font-weight: bold;
            fill: #888;
            text-anchor: middle;
            dominant-baseline: middle;
            pointer-events: none;
        }

        .label-text {
            font-size: 12px;
            font-weight: bold;
            text-anchor: middle;
            dominant-baseline: middle;
            pointer-events: none;
            fill: #555;
        }

        /* レスポンシブ対応 */
        @media (max-width: 800px) {
            .container {
                flex-direction: column-reverse;
                align-items: center;
                padding: 20px;
            }
            .chart-area {
                width: 100%;
                max-width: 400px;
                aspect-ratio: 1/1;
                height: auto;
            }
            .input-area {
                width: 100%;
            }
        }
    </style>
</head>
<body>

    <h1>人生の輪</h1>

    <div class="container">
        <div class="input-area" id="inputs-container"></div>

        <div class="chart-area">
            <svg id="wheel-svg" viewBox="0 0 500 500">
                <g id="slices-layer"></g>     <g id="guides-layer"></g>     <g id="scales-layer"></g>     <g id="labels-layer"></g>     </svg>
        </div>
    </div>

<script>
    // --- 設定 ---
    const categories = [
        "仕事・キャリア", "お金・経済", "健康", "家族・パートナー",
        "人間関係", "学び・自己啓発", "遊び・余暇", "物理的環境"
    ];
    // カテゴリごとの色
    const colors = [
        "#FF6B6B", "#4ECDC4", "#45B7D1", "#FFA07A",
        "#96CEB4", "#D4A5A5", "#9B59B6", "#3498DB"
    ];

    const maxScore = 10;
    const centerX = 250;
    const centerY = 250;
    const radius = 180;       // グラフの半径
    const labelRadius = 215;  // ラベルの距離

    // 12時の方向(-90度)から開始するためのオフセット
    const angleOffset = -Math.PI / 2;
    const stepAngle = (Math.PI * 2) / categories.length;

    // DOM要素
    const inputsContainer = document.getElementById('inputs-container');
    const svgElement = document.getElementById('wheel-svg');
    const slicesLayer = document.getElementById('slices-layer');
    const guidesLayer = document.getElementById('guides-layer');
    const scalesLayer = document.getElementById('scales-layer');
    const labelsLayer = document.getElementById('labels-layer');

    // --- 初期化 ---
    function init() {
        createInputs();
        createChartBase();
        updateChart();

        // クリック/タッチイベント設定
        svgElement.addEventListener('mousedown', handleInteraction);
        svgElement.addEventListener('touchstart', (e) => {
            e.preventDefault();
            handleInteraction(e.touches[0]);
        }, {passive: false});
    }

    // 1. スライダー生成
    function createInputs() {
        categories.forEach((cat, index) => {
            const div = document.createElement('div');
            div.className = 'input-group';
            div.innerHTML = `
                <span class="input-label">${cat}</span>
                <div class="slider-wrapper">
                    <input type="range" min="0" max="10" value="5" step="1" data-index="${index}">
                    <span class="score-value" id="val-${index}">5</span>
                </div>
            `;
            inputsContainer.appendChild(div);
        });

        inputsContainer.addEventListener('input', (e) => {
            if(e.target.tagName === 'INPUT') {
                const idx = e.target.getAttribute('data-index');
                document.getElementById(`val-${idx}`).textContent = e.target.value;
                updateChart();
            }
        });
    }

    // 2. グラフのガイド、目盛り、ラベル生成
    function createChartBase() {
        // 同心円
        for (let i = 1; i <= maxScore; i++) {
            const r = (radius / maxScore) * i;
            const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
            circle.setAttribute("cx", centerX);
            circle.setAttribute("cy", centerY);
            circle.setAttribute("r", r);
            
            // 5の円だけ強調(highlight)、それ以外は通常
            if (i === 5) {
                circle.setAttribute("class", "guide-circle highlight");
            } else {
                circle.setAttribute("class", "guide-circle");
            }
            guidesLayer.appendChild(circle);

            // 目盛り数値（5のみ表示）
            if (i === 5) {
                const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
                // 左側（9時の方向）に配置: X = 中心 - 半径
                text.setAttribute("x", centerX - r);
                text.setAttribute("y", centerY);
                text.setAttribute("class", "scale-text");
                text.setAttribute("dy", "-5"); // 線の上に少し浮かせる
                text.textContent = i;
                scalesLayer.appendChild(text);
            }
        }

        // 放射線とカテゴリラベル
        categories.forEach((cat, i) => {
            const angle = stepAngle * i + angleOffset;
            
            // 放射線
            const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
            line.setAttribute("x1", centerX);
            line.setAttribute("y1", centerY);
            line.setAttribute("x2", centerX + radius * Math.cos(angle));
            line.setAttribute("y2", centerY + radius * Math.sin(angle));
            line.setAttribute("class", "guide-line");
            guidesLayer.appendChild(line);

            // ラベル
            const midAngle = angle + (stepAngle / 2);
            const lx = centerX + labelRadius * Math.cos(midAngle);
            const ly = centerY + labelRadius * Math.sin(midAngle);

            const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
            text.setAttribute("x", lx);
            text.setAttribute("y", ly);
            text.setAttribute("class", "label-text");
            text.textContent = cat;
            labelsLayer.appendChild(text);

            // 扇形（スライス）プレースホルダー
            const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
            path.setAttribute("class", "slice");
            path.setAttribute("fill", colors[i % colors.length]);
            path.setAttribute("data-index", i);
            slicesLayer.appendChild(path);
        });
    }

    // 3. 値に基づいて扇形を更新
    function updateChart() {
        const inputs = document.querySelectorAll('input[type="range"]');
        const slices = document.querySelectorAll('.slice');

        inputs.forEach((input, i) => {
            const score = parseInt(input.value);
            const r = (radius / maxScore) * score;
            const startAngle = stepAngle * i + angleOffset;
            const endAngle = stepAngle * (i + 1) + angleOffset;

            const x1 = centerX + r * Math.cos(startAngle);
            const y1 = centerY + r * Math.sin(startAngle);
            const x2 = centerX + r * Math.cos(endAngle);
            const y2 = centerY + r * Math.sin(endAngle);

            let d = "";
            if (score === 0) {
                d = `M ${centerX} ${centerY} Z`; 
            } else {
                d = `M ${centerX} ${centerY} L ${x1} ${y1} A ${r} ${r} 0 0 1 ${x2} ${y2} Z`;
            }
            slices[i].setAttribute("d", d);
        });
    }

    // 4. クリック/タッチ操作
    function handleInteraction(eventPoint) {
        const rect = svgElement.getBoundingClientRect();
        const scaleX = 500 / rect.width;
        const scaleY = 500 / rect.height;
        const x = (eventPoint.clientX - rect.left) * scaleX - centerX;
        const y = (eventPoint.clientY - rect.top) * scaleY - centerY;

        let angle = Math.atan2(y, x) - angleOffset;
        if (angle < 0) angle += Math.PI * 2;
        
        const index = Math.floor(angle / stepAngle) % categories.length;
        const dist = Math.sqrt(x*x + y*y);
        let score = Math.round((dist / radius) * maxScore);
        
        if (score > maxScore) score = maxScore;
        if (score < 0) score = 0;

        const input = document.querySelector(`input[data-index="${index}"]`);
        if (input) {
            input.value = score;
            document.getElementById(`val-${index}`).textContent = score;
            updateChart();
        }
    }

    init();

</script>
</body>
</html>
